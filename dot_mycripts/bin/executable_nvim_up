#!/bin/bash

# Define text colors
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Check if the version variable is set, otherwise set default value. Example: VER="v0.9.5"
if [ -z "$VER" ]; then
  VER="nightly"
fi

# Download the neovim release tar.gz file to /tmp folder
printf "${GREEN}Downloading Neovim version $VER...${NC}\n"
wget -O /tmp/nvim-macos.tar.gz "https://github.com/neovim/neovim/releases/download/$VER/nvim-macos-arm64.tar.gz"

# Clear extended attributes
xattr -c /tmp/nvim-macos.tar.gz

# Extract the contents
printf "${GREEN}Extracting files...${NC}\n"
tar xzvf /tmp/nvim-macos.tar.gz -C /tmp/

# Remove the existing destination directory if it exists
if [ -d ~/nvim-macos ]; then
  rm -rf ~/nvim-macos
fi

# Move the extracted folder to ~/nvim-macos
mv /tmp/nvim-macos-arm64 ~/nvim-macos

# Remove the downloaded file from /tmp
rm /tmp/nvim-macos.tar.gz

# Show the new Neovim version
printf "${GREEN}Neovim upgraded successfully to version $VER.${NC}\n"
printf "${GREEN}Version details:${NC}\n"
~/nvim-macos/bin/nvim -v
